<!DOCTYPE html>
<html lang="en" class="pet-page" data-ready="0">

<head>
  <!-- prefs bootstrap: put in <head> of every page -->
  <script>
    (function () {
      const PREFS_KEY = 'gs_prefs';
      let p = {};
      try { p = JSON.parse(localStorage.getItem(PREFS_KEY) || '{}'); } catch { }
      document.documentElement.style.setProperty('--motion-scale', p.reducedMotion ? '0' : '1');
      document.documentElement.style.setProperty('--text-size', p.largerText ? '1.1rem' : '1rem');
    })();
  </script>

  <script>
    (function () {
      const PUBLIC_PAGES = ["index.html", "important-numbers.html", "privacy.html", "login.html", "register.html"];
      const path = location.pathname.split("/").pop() || "index.html";
      if (PUBLIC_PAGES.includes(path)) return;

      // Hide immediately to avoid UI flash
      document.documentElement.style.visibility = "hidden";

      const goLogin = () => {
        location.href = "login.html?next=" + encodeURIComponent(location.href);
      };

      // Helper: allow offline if we have a remembered user
      function allowOfflineIfRemembered() {
        try {
          const uid = localStorage.getItem("currentUser");
          const authed = sessionStorage.getItem("fs_logged_in") === "1";
          if (uid || authed) {
            document.documentElement.style.visibility = "";
            document.documentElement.setAttribute("data-ready", "1");
            return true;
          }
        } catch { }
        return false;
      }

      (async () => {
        try {
          // Try real Firebase Auth (online case)
          const { getAuth, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
          const { auth } = await import("./firebase-init.js");
          onAuthStateChanged(auth, (user) => {
            if (!user) return goLogin();
            document.documentElement.style.visibility = "";
            document.documentElement.setAttribute("data-ready", "1");
          });
        } catch (e) {
          // Offline or CDN problem ‚Üí allow offline if we remember a user, else login
          if (!navigator.onLine && allowOfflineIfRemembered()) return;
          goLogin();
        }
      })();
    })();
  </script>
    
  <!-- At the top of delete-account.html <body> or in <head> -->
  <script type="module">
    import './firebase-init.js'; // ensures app/auth/db are initialized
  </script>
    
    <script type="module">
      import { auth, db } from './firebase-init.js';
      import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
      import { doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

      const LOCAL_MARK = 'gs_session_ack_ts';
      onAuthStateChanged(auth, (user) => {
        if (!user) return;
        const uref = doc(db, 'users', user.uid);
        onSnapshot(uref, async (snap) => {
          const bump = snap?.data()?.sessionBumpedAt?.toMillis?.() || 0;
          const seen = parseInt(localStorage.getItem(LOCAL_MARK) || '0', 10);
          if (bump > seen) {
            localStorage.setItem(LOCAL_MARK, String(bump));
            try { await signOut(auth); } finally { location.replace('login.html'); }
          }
        });
      });
    </script>
    
  <!-- 0) Auth gate (protected page) -->
  <meta name="auth" content="required">
  <script type="module" src="auth.js"></script>

  <!-- prefs bootstrap: put in <head> of every page -->
  <script>
    (function () {
      const PREFS_KEY = 'gs_prefs';
      let p = {};
      try { p = JSON.parse(localStorage.getItem(PREFS_KEY) || '{}'); } catch { }
      document.documentElement.style.setProperty('--motion-scale', p.reducedMotion ? '0' : '1');
      document.documentElement.style.setProperty('--text-size', p.largerText ? '1.1rem' : '1rem');
    })();
  </script>

  <!-- 1) FOUC guard: keep hidden until theme & auth are ready -->
  <style>
    html:not([data-ready="1"]) {
      visibility: hidden
    }
  </style>

  <!-- 2) Base paint so Chrome/Safari UI bars don't flash -->
  <style>
    html,
    body {
      min-height: 100%;
      margin: 0;
      background: var(--bg-color, #030352) !important;
      color: var(--text-color, #ffffff) !important;
    }
  </style>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Three Sides ‚Äî MY PET</title>
  <meta name="description" content="Care for your companion, earn milestones, and keep your streak growing." />
  <meta name="theme-color" content="#030352">
  <meta name="color-scheme" content="dark light">

  <!-- iOS/Android PWA friendliness -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="apple-mobile-web-app-title" content="3-Sides">

  <!-- PWA -->
  <!-- Absolute (good for GitHub Pages) -->
  <link rel="manifest" href="manifest.webmanifest">
  
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" sizes="any" href="/3-sides-planner.io/favicon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/3-sides-planner.io/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/3-sides-planner.io/favicon-16.png">
  <link rel="apple-touch-icon" href="/3-sides-planner.io/icon-192.png"> <!-- iOS Home screen -->

  <!-- Preconnects so Firebase/fonts start quicker -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="//www.gstatic.com">
  <link rel="dns-prefetch" href="//firestore.googleapis.com">
  <link rel="dns-prefetch" href="//identitytoolkit.googleapis.com">

  <!-- Fonts + CSS (non-blocking) -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <link rel="preload" href="style.css" as="style" onload="this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="style.css">
  </noscript>
  <link rel="preload" href="mainTheme.css" as="style" onload="this.rel='stylesheet'">
  <noscript>
    <link rel="stylesheet" href="mainTheme.css">
  </noscript>

  <!-- Preload the hero image so it appears immediately -->
  <link rel="preload" href="pet-baby.png" as="image" imagesrcset="pet-baby.png">

  <!-- Early Theme Boot (same idea as index.html) -->
  <script>
    (function () {
      try {
        const root = document.documentElement;
        const userKey = localStorage.getItem("currentUser") || "anon";
        const savedTheme =
          localStorage.getItem(userKey + ":themeClass") ||
          localStorage.getItem("themeClass") ||
          localStorage.getItem("themeClass:last") ||
          "theme-original";

        const keep = (root.className || "").split(/\s+/).filter(Boolean).filter(c => !c.startsWith("theme-"));
        root.className = [...keep, savedTheme].join(" ");

        // Sync browser bars
        const meta = document.querySelector('meta[name="theme-color"]') || (function () {
          const m = document.createElement('meta'); m.name = 'theme-color'; document.head.appendChild(m); return m;
        })();
        const cs = getComputedStyle(root);
        meta.content = (cs.getPropertyValue('--accent-color') || cs.getPropertyValue('--accent') || '#030352').trim() || '#030352';
      } catch { }
    })();
  </script>

  <!-- Service worker registration (non-blocking) -->
  <script src="sw-register.js" defer></script>

  <!-- -------------------- PAGE CSS STARTS HERE -------------------- -->
  <style>
    .pet-container {
      color: white;
      background: #030352;
      max-width: 100%;
      margin: 0 auto;
      overflow: hidden
    }

    .three-d-title {
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 2rem;
      color: white;
      letter-spacing: 1.5px;
      font-weight: bold
    }

    button {
      font-family: 'Georgia', serif;
      font-size: 1.2rem;
      border: 1px solid white;
      border-radius: 1rem;
      background-color: #00080a;
      color: white;
      cursor: pointer;
      transition: background-color .3s, transform .2s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, .1)
    }

    button:hover:not(:disabled) {
      background-color: rgb(73, 64, 64);
      transform: scale(1.05)
    }

    button:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
      opacity: .6
    }

    #petImage {
      width: 200px;
      margin-bottom: 1.5rem;
      animation: bounce 2s ease-in-out infinite
    }

    .pet-wrapper {
      position: relative;
      width: 350px;
      height: 350px;
      margin: 0 auto;
      background-image: url("forest.png");
      background-size: cover;
      background-position: center;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1
    }

    @keyframes bounce {

      0%,
      100% {
        transform: translateY(0)
      }

      50% {
        transform: translateY(-10px)
      }
    }

    .thankMsg {
      display: none;
      font-style: italic;
      color: #4ba333;
      margin-top: .5rem
    }

    footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 1.2rem;
      color: black;
      padding: 1rem
    }

    @media (max-width:600px) {
      .pet-container {
        padding: 1.2rem
      }

      .three-d-title {
        font-size: 2rem
      }

      button {
        font-size: 1rem;
        padding: .6rem 1rem
      }
    }

    .torn-paper-divider {
      width: 100%;
      height: 60px;
  background: url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 1440 150' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23102514' stroke='rgba(211,220,50,0.6)' stroke-width='3' d='M0,40 Q80,90 160,40 T320,40 T480,40 T640,40 T800,40 T960,40 T1120,40 T1280,40 T1440,40 L1440,0 L0,0 Z'/%3E%3C/svg%3E") no-repeat center;
  background-size: cover;
      margin: 0;
      padding: 0;
      transform: rotate(180deg)
    }

    body {
    /* use theme variables, not hard-coded !important to avoid flash */
      background: var(--page-bg, rgb(3, 3, 82));
      color: var(--page-fg, #fff);  
      text-align: center;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fafafa;
      border-top: 1px solid rgba(69, 111, 179, .903);
      display: flex;
      justify-content: space-around;
      padding: .8rem 0;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, .05)
    }

    .nav-icon {
      text-decoration: none;
      color: rgba(69, 111, 179, .903);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      transition: color .3s
    }

    .nav-icon span {
      font-size: .75rem;
      margin-top: .2rem;
      color: rgba(69, 111, 179, .903)
    }

    .nav-icon:hover,
    .nav-icon:focus {
      color: #72aadf;
      outline: none
    }

    /* Sparkles */
    .full-page-sparkle-wrapper {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999
    }

    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, rgba(255, 255, 255, .8) 0%, transparent 70%);
      border-radius: 50%;
      opacity: 0;
      animation: sparkle-twinkle 4s infinite ease-in-out;
      box-shadow: 0 0 6px rgba(255, 255, 255, .5)
    }

    @keyframes sparkle-twinkle {

      0%,
      100% {
        opacity: .1;
        transform: scale(.6)
      }

      50% {
        opacity: 1;
        transform: scale(1.4)
      }
    }

    .white-button {
      background-color: #9ec1ff; /* ===== color for quetions buttons */
      color: black;
      font-size: 1rem;
      font-weight: bold;
      padding: .6rem 1.2rem;
      border: 2px solid #82a9eb;
      border-radius: 8px;
      cursor: pointer;
      margin: .5rem;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, .15);
      transition: background-color .2s, color .2s, transform .2s
    }

    .white-button:hover {
      background-color: rgb(176, 176, 74);
      transform: scale(1.04)
    }

    .white-button:disabled {
      background-color: #102514;
      color: white;
      border: 2px solid #999
    }

    @media (max-width:600px) {
      .pet-action-buttons {
        display: flex;
        flex-direction: column;
        gap: 1rem
      }

      .white-button {
        width: 100%;
        max-width: 160px
      }
    }

    h1 {
      color: #eef0bae1;
    }

    /* ----------- BADGE WALL (pet page) ----------- */
    .pet-badges {
      margin: 1.25rem auto;
      max-width: 680px
    }

    .pet-badges h3 {
      margin: 0 0 .75rem;
      text-align: center;
      color: #123e24
    }

    .badge-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 14px
    }

    @media (max-width:460px) {
      .badge-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr))
      }
    }

    .badge {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: .45rem
    }

    /* Square badges (soft corners) */
.icon{
  width:94px; height:94px; border-radius:22px; /* <- was 50% */
  display:flex; align-items:center; justify-content:center;
  font-size:38px;
  background: radial-gradient(70% 70% at 30% 30%, hsl(var(--h,210) 80% 70%) 0%, hsl(var(--h,210) 80% 55%) 45%, hsl(var(--h,210) 80% 45%) 100%);
  box-shadow: 0 6px 18px rgba(0,0,0,.25), inset 0 0 18px rgba(255,255,255,.25);
  border: 1.2px solid rgba(107, 122, 111, 0.7);
  transition: transform .12s ease, filter .2s ease, opacity .2s ease;
}

    .badge.locked .icon {
      filter: grayscale(1);
      opacity: .5;
      background: linear-gradient(135deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border-color: rgba(129, 105, 105, 0.35)
    }

    .label {
      font-size: .85rem;
      color: black;
      opacity: .95;
      text-align: center;
      max-width: 112px
    }

    .badge.locked .label {
      color: black
    }

    @media (max-width:460px){
  .icon{ width:86px; height:86px; border-radius:18px; }
}

/* Force 4 per row everywhere */
#petBadgeWall .badge-grid { 
  grid-template-columns: repeat(4, minmax(0, 1fr)) !important;
  gap: 10px !important;
  padding: 0 6px;
}

/* Smaller, square tiles */
#petBadgeWall .icon{
  width: 80px; height: 80px; border-radius: 16px;
  font-size: 32px;
}

/* Tighter labels */
#petBadgeWall .label{
  font-size: .78rem; 
  max-width: 88px;
}

/* Make sure no media query forces 3 per row */
@media (max-width: 460px){
  #petBadgeWall .badge-grid { grid-template-columns: repeat(4, minmax(0,1fr)) !important; }
}

/* Base paint pinned to PET blue so nothing green flashes */
  html.pet-page,
  html.pet-page body {
    min-height: 100%;
    margin: 0;
    background-color: #3bb5b3 !important;
    color: #fff !important;
  }

  /* Also expose the blue via CSS vars for anything that reads them */
  html.pet-page {
    --bg-color: #030352;
    --text-color: #ffffff;
    --chrome-ui-color: #030352; /* we'll use this for theme-color meta */
  }

  /* ============== h3 - subheadings - sections title colors =========== */ 
  /* Only affect h3 inside your pet sections */
#journalSection h3 { 
  color: rgb(44, 44, 40);           /*  grey sub headings */
}

#waterSection h3 { 
  color: rgb(44, 44, 40);           /*  grey sub headings */
}

#kindnessSection h3 { 
  color: rgb(44, 44, 40);           /*  grey sub headings */
}

/* ================== buttons: side-by-side ============== */
/* Row layout for Journal + Water + Kindness sections */
.section .button-stack{
  display: flex;
  flex-direction: row;
  justify-content: center;   /* <-- centers the buttons */
  align-items: center;
  gap: 1.75rem;
  margin-top: .05rem;
  width: 100%;
}

/* Headline spacing (less space above the buttons) */
#journalSection h3,
#waterSection h3,
#kindnessSection h3 {
  margin: 0 0 .05rem;   /* <-- tighten the gap below the h3 */
}

/* Row of buttons */
.section .button-stack{
  display: flex;
  flex-direction: row;
  justify-content: center;  /* center the row */
  align-items: center;
  gap: .45rem;                /* space *between* the two buttons */
  margin-top: 1.3rem;        /* almost no space above */
  width: 100%;
}

/* Extra space below the buttons before the next section */
#journalSection .button-stack,
#waterSection .button-stack,
#kindnessSection .button-stack {
  margin-bottom: 3.25rem;   /* bump this up/down to taste */
}

/* Smaller headings above the button rows */
#journalSection > h3,
#waterSection > h3,
#kindnessSection > h3 {
  font-size: 1.15rem;   /* tweak to taste (e.g., 1rem) */
  line-height: 1.25;    /* a bit tighter */
  margin: 0 0 .35rem;   /* keep the tighter gap you wanted */
}

/* Optional: even smaller on narrow phones */
@media (max-width: 430px){
  #journalSection > h3,
  #waterSection > h3,
  #kindnessSection > h3 {
    font-size: 1.15rem;
    font-weight: bold;
  }
}

/* ============= over rides ============= */
/* 1) Never allow horizontal scrolling */
html, body { max-width: 100%; overflow-x: hidden !important; }

/* 2) Make padding count toward width so 100% + padding doesn't overflow */
*, *::before, *::after { box-sizing: border-box!important; }

/* 3) Core wrappers can‚Äôt exceed the viewport width */
.pet-container, .pet-wrapper { max-width: 100%; overflow-x: hidden!important; }

/* 4) Media never pushes layout */
img, svg, video { max-width: 100%; height: auto; display: block!important; }

/* 5) Grids don‚Äôt create min-content overflow */
.badge-grid { min-width: 0!important; }

/* 6) Button rows won‚Äôt overflow on tighter screens */
.section .button-stack { flex-wrap: wrap!important; }

/* 7) Anything that spans full width stays clipped to viewport */
.torn-paper-divider { width: 100%; max-width: 100vw; overflow: hidden; display: block!important; }

/* ==== STOP SIDEWAYS SCROLL (hard locks) ==== */
html, body {
  width: 100%!important;
  max-width: 100vw!important;
  overflow-x: hidden !important;
}

/* Body shouldn't be a flex container here; let inner containers center themselves */
body { display: block!important; }

/* Fixed bottom nav: distribute items evenly and never overflow */
.bottom-nav {
  left: 0; right: 0; width: auto!important;  /* avoids 100% + border overflow */
  overflow-x: hidden!important;
  display: flex!important;
}

.bottom-nav .nav-icon {
  flex: 1 1 0!important;    /* equal columns */
  min-width: 0!important;   /* allow shrink */
  text-align: center!important;
}

/* Pet image wrapper: responsive so it never exceeds the viewport */
.pet-wrapper {
  width: min(350px, 92vw)!important;
  height: min(350px, 92vw)!important;
  margin-inline: auto!important;
}

/* Badge grid can't force a min-content width */
#petBadgeWall .badge-grid { min-width: 0!important; }

/* Torn divider can‚Äôt push width */
.torn-paper-divider { max-width: 100vw; overflow: hidden!important; }

/* Media never push layout */
img, svg, video { max-width: 100%; height: auto; display: block!important; }

/* exact room for the fixed bottom nav */
:root { --nav-gap: 4.25rem; }   /* tweak up/down to taste */

/* shrink the Reset button margins only */
#resetPetBtn {
  margin: .1rem auto .5rem!important;  /* top | sides | bottom */
  display: inline-block;
}

/* if you want *all* buttons smaller margins, you can also tame the global: */
/* button { margin: 1rem; }  */

/* Center the thank-you messages under each button row */
.section .thankMsg{
  text-align: center;
  margin: .45rem auto 1.25rem;  /* top | sides | bottom */
  max-width: 320px;             /* optional: keeps line length comfy */
  display: block;  
  font-size: 1.2rem; 
  color: #4ba333;            /* stays block when JS sets display="block" */
}

/* Respect iPhone safe area if present */
@supports(padding-top: env(safe-area-inset-top)){
  .pet-container{ padding-top: calc(env(safe-area-inset-top) + 10px); }
}

/* Tighter gap from buttons ‚Üí thank-you line */
.section .button-stack{
  margin-bottom: .45rem !important;   /* was ~3rem in earlier CSS */
}

.thankMsg{
  margin: .25rem 0 0 !important;      /* almost no space above */
  padding: 0 !important;
  line-height: 1.2;                    /* tighter lines */
  text-align: center!important;                  /* keep centered */
}

/* make rows wrap so the message can drop under the buttons */
.section .button-stack { flex-wrap: wrap; }

/* case A: message is INSIDE the .button-stack (journal) */
.section .button-stack .thankMsg{
  flex: 0 0 100%;       /* take a full row */
  text-align: center;
  margin: .35rem 0 1rem;
}

/* case B: message is OUTSIDE the .button-stack (water/kindness) */
.section > .thankMsg{
  text-align: center;
  margin: .35rem auto 1rem;
}

/* common style */
.section .thankMsg{
  color: #4ba333;
  line-height: 1.2;
}

/* give the content *just* enough bottom padding for the fixed footer */
.pet-container{
  padding-bottom: calc(env(safe-area-inset-bottom, 0) + 70px) !important;
}

/* sit the button close to the footer without overlap */
#resetPetBtn{
  display: block;
  margin: .4rem auto calc(env(safe-area-inset-bottom, 0) + .35rem) !important;
}

/* optional: reduce extra gap under the badges */
.pet-badges{ margin-bottom: .5rem; }

/* ============== override for reset button ================ */
/* ‚Äî‚Äî‚Äî Center + tighten the green messages ‚Äî‚Äî‚Äî */

/* Keep them hidden by default; JS sets display:block when earned */
.thankMsg{
  display: none;               /* ‚Üê keep this; do NOT set display:block in other rules */
  font-style: italic;
  color: #4ba333;
  margin: .25rem 0 0;
  padding: 0;
  line-height: 1.2;
}

/* Button rows: smaller gap before the message */
.section .button-stack{ margin-bottom: .35rem !important; }

/* If the message is INSIDE the .button-stack (e.g., Journal) */
.section .button-stack .thankMsg{
  flex: 0 0 100%;              /* take the full row */
  text-align: center;
  margin: .25rem auto 1rem;    /* centered, small top gap */
  /* no display property here */
}

/* If the message is OUTSIDE the .button-stack (e.g., Water/Kindness) */
.section > .thankMsg{
  text-align: center;

  /* no display property here */
}

/* ‚Äî‚Äî‚Äî Pull the Reset button closer to the navbar ‚Äî‚Äî‚Äî */

/* Just enough room for the fixed nav + safe area */
.pet-container{
  padding-bottom: calc(env(safe-area-inset-bottom, 0) + 0px) !important;
}

/* Sit the button close to the nav without overlap */
#resetPetBtn{
  display: block;
  margin: 0rem auto calc(env(safe-area-inset-bottom, 0) + .2rem) !important;
}

/* Reduce extra gap under the badges block */
.pet-badges{ margin-bottom: 0rem !important; }

/* Center all green ‚Äúthank you‚Äù messages (whether inside or outside .button-stack) */
#journalSection > .thankMsg,
#waterSection  > .thankMsg,
#kindnessSection > .thankMsg,
.section .button-stack .thankMsg {
  text-align: center !important;      /* center the text */
  margin: .25rem auto 1rem !important;/* auto = center the block */
  max-width: 320px;                    /* optional: comfy line-length */
  width: 100%;                         /* full row so centering is obvious */
  /* keep them hidden by default; your JS sets display="block" when needed */
  display: none;
}

/* If a message lives INSIDE the flex row, force it onto its own line */
.section .button-stack .thankMsg {
  flex: 0 0 100% !important;           /* new row in the flex container */
}

/* =========================== x's feed button ========================== */
/* pet status line under the hero message */
.pet-stats{
  width:min(350px,92vw);
  margin:.25rem auto .35rem;
  text-align:center;
  color: yellowgreen;              
  font-weight:700;
}

/* Status line nudge so it aligns with other content */
.pet-stats{ margin:.2rem auto 0; width:min(350px,92vw); text-align:left; padding-left:12px; }

  /* Reuse one width so the stats line doesn't extend past your buttons */
  :root { --inner-width: 340px; } /* tweak to match your button stack */

  .pet-stats {
    max-width: var(--inner-width);
    margin: 0 auto 6px;     /* center the block, sit just above buttons */
    text-align: center;      /* align text center */
    color: yellowgreen;     /* overall text color */
    font-weight: 600;
    line-height: 1.2;
  }

  .pet-stats .pet-name,
  .pet-stats .label {
    color: rgb(98, 224, 98);
    font-size: bolder;    /* make ‚ÄúBaby‚Äù and ‚Äúfeeds:‚Äù match */
    font-size: bolder;    /* make ‚ÄúBaby‚Äù and ‚Äúfeeds:‚Äù match */
  }

  .pet-stats .sep {
    opacity: 0.8;
    padding: 0 .35rem;
  }

  #feedCount {
    color: white;
  }

/* ========================= come-back-message ==================== */
  /* Inline daily-complete notice (below kindnessSection, not fixed) */
/* ============ come back message after completing all functions */
  #completeMsg {
    display: none;                 /* hidden by default */
    margin: 16px 0 0;
    padding: 12px 14px;
    border: 1px solid rgba(255,255,255,.18);
    background: #102514;
    border: 5mm ridge rgb(211 220 50 / 0.6);
    backdrop-filter: blur(2px);
    -webkit-backdrop-filter: blur(2px);
    text-align: center;
    font-weight: 600;
    letter-spacing: .2px;
    color: var(--text-color, #fff);
  }

  /* Light theme safety */
  .theme-original #completeMsg,
  .theme-bingo #completeMsg,
  [data-theme="light"] #completeMsg {
    background: rgba(255,255,255,.85);
    color: #111;
    border-color: rgba(0,0,0,.08);
  }
  /* Shown when complete */
  #completeMsg.show { display: block; }

  #feedMsg, #waterMsg, #bathMsg { 
    color: rgb(38, 38, 45); 
  }           

/* =================== top brown portion =============== */
  /* Full-bleed brown band from very top down through #petMessage */
  .hero-brown.full-bleed {
    /* brown you can tweak */
    --hero-bg: #102514;
    --hero-fg: #f5efe6;   
    background: var(--hero-bg);
    color: var(--hero-fg);
  }

  /* IMPORTANT: kill the blue card background just for this area */
  .hero-brown .pet-container {
    background: transparent !important;
    box-shadow: none;
  }

  /* Keep your chosen text color for the intro line */
  .hero-brown #petMessage {
    color: #e9ee7e !important;
  }

  /* Optional: ensure sparkles still float above if you need it */
  /* #sparkleWrapper { position: fixed; inset: 0; pointer-events:none; z-index: 2; }
     .hero-brown    { position: relative; z-index: 1; } */

/* =============== fix top blue strip above brown - no blue shown ================= */
/* 1) Kill the default page gap */
  html, body { margin: 0; padding: 0; }

  /* 3) Make the brown band start at the literal top (incl. notches) */
  .hero-brown.full-bleed {
    --hero-bg: #3bb5b3;    /* top half color behind image  */
    --hero-fg: #f5efe6;

    /* full-bleed edge to edge */
    width: 100vw;
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);

    background: var(--hero-bg);
    color: var(--hero-fg);

    /* push content down but keep background at the top */
    padding-top: calc(16px + env(safe-area-inset-top, 0px));
    padding-bottom: 12px;
    border-bottom: 7mm ridge #9ec1ff;
    position: relative;
    z-index: 1;            /* above sparkles layer if needed */
  }

  /* 4) Prevent first-child margin from creating a top gap */
  .hero-brown h1:first-child { margin-top: 0; }

  /* keep your intro line yellow on brown */
  .hero-brown #petMessage { color: #042d20c8 !important; }

  /* if .pet-container paints blue, neutralize it inside the hero only */
  .hero-brown .pet-container { background: transparent !important; box-shadow: none; }

  /* Height of your bottom nav (tweak if yours is taller/shorter) */
  :root { --nav-h: 74px; }

  /* Keep content clear of the fixed/sticky bottom nav */
  body {
    /* room for nav + a little breathing space + iPhone home-indicator */
    padding-bottom: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px) + 16px);
  }

/* ======================== reset button at the bottom of pet =================== */
  /* Make the reset button obvious and centered */
  #resetPetBtn.reset-btn {
    display: block;
    width: min(520px, 92%);
    margin: 16px auto 12px;
    padding: 12px 16px;
    border: .9px solid #102514;
    border-radius: 14px;
    font-weight: 700;
    text-align: center;
    background:  rgba(191, 192, 206, 0.6); /* warm gold */
    color: black;
    box-shadow: 0 6px 18px rgba(0,0,0,.18);
    cursor: pointer;
  }

  /* If a parent has overflow hidden, this helps bring it into view on anchor jumps */
  #resetPetBtn { scroll-margin-bottom: calc(var(--nav-h) + 20px); }

  /* wrap baby * feeds */
/* (2) */
.status-wrap.card{
  max-width: var(--inner-width);
  margin: .5rem auto .25rem;
  padding: 8px 12px;
  border-radius: 12px;
  background: rgb(60, 65, 44);
  border: 1px solid rgba(255,255,255,.18);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
}

/* keep the text tidy inside */
.pet-stats{
  margin: 0;
  text-align: center;   /* or left; your call */
}

.status-wrap.card{
  max-width: 200px;     /* or 180px */
  margin: .5rem auto .25rem;
}

.status-wrap.card{
  display: flex;
  justify-content: center;   /* centers the <p> horizontally */
}
.pet-stats{ margin: 0; }

/* ================= register css add ons ================ */
/* ADDED: tiny legal footer style for the Privacy link */
/* Privacy link at the bottom: make it match the accent */
.legal-footer a { color: #C9BBFF !important; }              /* link color */
.legal-footer a:hover { text-decoration: underline; filter: brightness(1.12); }
 
/* ================= navbar overrides ============= */
/* === Glow Standard Bottom Nav (namespaced) === */
:root{
  --gs-nav-h: 64px;
  --gs-nav-fs: 12px;   /* label */
  --gs-nav-ico: 20px;  /* emoji */
  --gs-nav-bg: #fafafa;
  --gs-nav-border: rgba(69,111,179,.25);
  --gs-nav-text: rgba(69,111,179,1);
  --gs-nav-active: #0b6cc4;
}

/* Reserve space for the fixed bar (opt-in via body.gs-has-nav) */
body.gs-has-nav{
  padding-bottom: calc(var(--gs-nav-h) + env(safe-area-inset-bottom, 0px));
}

/* The fixed bar */
footer.gs-nav{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  height: var(--gs-nav-h);
  background: var(--gs-nav-bg);
  border-top: 1px solid var(--gs-nav-border);
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding: 0 env(safe-area-inset-left,8px) 0 env(safe-area-inset-right,8px);
  z-index: 1000;
  overflow: hidden;
  box-sizing: border-box;
  /* normalize inheritance so pages can‚Äôt change it */
  font-size: 0; line-height: 1; font-family: inherit;
}

/* Items are equal columns */
.gs-nav__item{
  flex: 1 1 0;
  min-width: 0;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  text-decoration: none;
  color: var(--gs-nav-text);
  white-space: nowrap;
  padding: 0; margin: 0;
  box-sizing: border-box;
}

/* Explicit sizes (prevents page font from changing the bar) */
.gs-nav__item .ico { font-size: var(--gs-nav-ico); display:block; line-height:1; }
.gs-nav__item span { font-size: var(--gs-nav-fs); display:block; line-height:1; }

/* Active + hover */
.gs-nav__item[aria-current="page"]{ color: var(--gs-nav-active); font-weight: 700; }
.gs-nav__item:hover{ color:#72aadf; }

/* ================= navbar overrides ============= */
/* === Glow Standard Bottom Nav (namespaced) === */
:root{
  --gs-nav-h: 64px;
  --gs-nav-fs: 12px;   /* label */
  --gs-nav-ico: 20px;  /* emoji */
  --gs-nav-bg: #fafafa;
  --gs-nav-border: rgba(69,111,179,.25);
  --gs-nav-text: rgba(69,111,179,1);
  --gs-nav-active: #0b6cc4;
}

/* Reserve space for the fixed bar (opt-in via body.gs-has-nav) */
body.gs-has-nav{
  padding-bottom: calc(var(--gs-nav-h) + env(safe-area-inset-bottom, 0px));
}

/* The fixed bar */
footer.gs-nav{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  height: var(--gs-nav-h);
  background: var(--gs-nav-bg);
  border-top: 1px solid var(--gs-nav-border);
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding: 0 env(safe-area-inset-left,8px) 0 env(safe-area-inset-right,8px);
  z-index: 1000;
  overflow: hidden;
  box-sizing: border-box;
  /* normalize inheritance so pages can‚Äôt change it */
  font-size: 0; line-height: 1; font-family: inherit;
}

/* Items are equal columns */
.gs-nav__item{
  flex: 1 1 0;
  min-width: 0;
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  text-decoration: none;
  color: var(--gs-nav-text);
  white-space: nowrap;
  padding: 0; margin: 0;
  box-sizing: border-box;
}

/* Explicit sizes (prevents page font from changing the bar) */
.gs-nav__item .ico { font-size: var(--gs-nav-ico); display:block; line-height:1; }
.gs-nav__item span { font-size: var(--gs-nav-fs); display:block; line-height:1; }

/* Active + hover */
.gs-nav__item[aria-current="page"]{ color: var(--gs-nav-active); font-weight: 700; }
.gs-nav__item:hover{ color:#72aadf; }

/* ===== Make pet buttons match Letter page buttons ===== */

:root {
  /* reuse the letter button colors */
  --pet-btn-bg: #0f766e;       /* main teal */
  --pet-btn-hover: #115e59;    /* darker teal on hover */
  --pet-btn-text: #ecfdf5;     /* soft minty-white text */
}

/* Journal / Water / Kindness buttons */
.white-button {
  background-color: var(--pet-btn-bg) !important;
  color: var(--pet-btn-text) !important;
  font-family: 'Open Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 1rem;
  font-weight: 600;
  padding: 0.6rem 1.2rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  margin: 0.5rem;
  box-shadow: 0 6px 18px rgba(15, 118, 110, 0.3);
  transition:
    background-color 0.2s ease,
    color 0.2s ease,
    transform 0.15s ease,
    box-shadow 0.2s ease;
}

/* Hover / focus ‚Äì same feel as Letter page */
.white-button:hover:not(:disabled),
.white-button:focus-visible:not(:disabled) {
  background-color: var(--pet-btn-hover) !important;
  color: var(--pet-btn-text) !important;
  transform: translateY(1px);
  box-shadow: 0 4px 12px rgba(15, 118, 110, 0.4);
  outline: none;
}

/* Disabled pet buttons (before journaling, etc.) */
.white-button:disabled {
  background-color: #e5e7eb !important;  /* light gray */
  color: #6b7280 !important;             /* muted gray text */
  border: none !important;
  box-shadow: none !important;
  cursor: not-allowed;
  transform: none;
}

/* Reset Pet button ‚Äì same style family, just a bit wider */
#resetPetBtn {
  background-color: var(--pet-btn-bg) !important;
  color: var(--pet-btn-text) !important;
  font-family: 'Open Sans', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 1rem;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  padding: 0.75rem 1.4rem;
  box-shadow: 0 6px 18px rgba(15, 118, 110, 0.3);
  cursor: pointer;
  width: min(520px, 92%);
  margin: 16px auto calc(env(safe-area-inset-bottom, 0) + 12px) !important;
  display: block;
  transition:
    background-color 0.2s ease,
    transform 0.15s ease,
    box-shadow 0.2s ease;
}

#resetPetBtn:hover {
  background-color: var(--pet-btn-hover) !important;
  transform: translateY(1px);
  box-shadow: 0 4px 12px rgba(15, 118, 110, 0.4);
}

/* --- Replace the double blue ridge with a soft teal divider that blends --- */
.hero-brown.full-bleed{
  border: 0 !important;              /* kill the ridge */
  position: relative;
}

.hero-brown.full-bleed::after{
  content:"";
  position: absolute;
  left: 0; right: 0; bottom: -1px;   /* sits right below the hero band */
  height: 14px;                      /* thickness of the fade */
  /* gentle teal bloom ‚Üí transparent */
  background: linear-gradient(
    to bottom,
    rgba(11, 94, 89, 0.35),          /* deep teal echo of buttons */
    rgba(11, 94, 89, 0.10) 55%,
    rgba(11, 94, 89, 0.00) 100%
  );
  /* tiny hairline to finish the edge cleanly */
  box-shadow: 0 1px 0 rgba(0,0,0,.06), 0 0 0 1px rgba(236, 253, 245, .06) inset;
  pointer-events: none;
}

/* --- Optional: tint the fixed bottom nav line to the same teal family --- */
:root{
  --gs-nav-border: rgba(11, 94, 89, .22) !important; /* was blue-ish */
  --gs-nav-text:   rgba(11, 94, 89, 1)  !important;
  --gs-nav-active: #0a4d48 !important;
}
/* uses your existing footer.gs-nav styles; this just recolors the border/text */

/* (Tiny polish) make the status pill sit better on teal */
.status-wrap.card{
  background: rgba(11, 94, 89, .10) !important; /* subtle glass teal */
  border: 1px solid rgba(11, 94, 89, .22) !important;
}

/* ================= register css add ons ================ */
/* ADDED: tiny legal footer style for the Privacy link */
/* Privacy link at the bottom: make it match the accent */
.legal-footer a { color: #C9BBFF !important; }              /* link color */
.legal-footer a:hover { text-decoration: underline; filter: brightness(1.12); }
   
  .legal-footer {
    color: black !important;
    text-align: center;
  }

  .legal-footer a {
    color: rgb(49, 64, 162) !important;
  }

  .section .button-stack .white-button{
  margin: 0 .4rem;          /* no vertical margin, small horizontal */
  flex: 1 1 0;              /* üîπ equal width for both buttons in the row */
  max-width: 180px;         /* üîπ cap so they don‚Äôt get huge on wide screens */
}

h3{
  font-size: 1.15rem;
  font-weight: 600;
}


/* =================== accessability (from systemSettings.html) =================== */
/*------------ accesability increase font size --------------- */
/* Default fallbacks in case gs_prefs hasn't been set yet */
:root {
  --text-size: 1rem;
  --motion-scale: 1;
}

/* Base text uses the variable from gs_prefs */
body {
  font-size: var(--text-size, 1rem);
}

/* Let most things inherit body size, instead of hardcoding rems */
p,
input[type="text"],
textarea,
.toolkit-item span,
.button,
.button-purple,
.idea-item,
#toolkitList .idea-text {
  font-size: 1em; /* 1em = whatever body is (1rem or 1.1rem, etc.) */
}

/* Scale headings relative to --text-size so they grow/shrink too */
h1.three-d-title,
h1.three-d-title-two {
  font-size: calc(var(--text-size, 1rem) * 1.7);
}

/* ------ text inside the top of the teal container ------ */
h3,
.dreamy-box h3 {
  font-size: calc(var(--text-size, 1rem) * 1.25);
}

/* ----------------------- reduce motion ----------*/
/* Use --motion-scale to tone down motion on this page */
.icon-button,
.button,
.toolkit-entry button,
.dropdown-icon-btn {
  transition:
    transform calc(150ms * var(--motion-scale, 1)),
    background-color 0.3s ease,
    box-shadow calc(150ms * var(--motion-scale, 1));
}

/* When motion-scale is 0, this becomes scale(1) (no ‚Äúpop‚Äù on hover) */
.icon-button:hover,
.button:hover,
.toolkit-entry button:hover,
.dropdown-icon-btn:hover {
  transform: scale(calc(1 + (0.03 * var(--motion-scale, 1))));
}

</style>

</head>

<body>
  <div class="full-page-sparkle-wrapper" id="sparkleWrapper"></div>
  
  <!-- START: brown hero strip -->
  <section class="hero-brown full-bleed">
  
    <div class="pet-container">
      <h1 style="
              color: rgb(63, 65, 33);
              text-align: center;
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              margin-top: .5rem;
              font-size: 1.8rem;
              font-weight: bolder;
            ">
      üåü Care for Your <br> Pet Friend üåü
      </h1>
    
<br>
    <div class="pet-wrapper">
      <img id="petImage" src="pet-baby.png" alt="Your Pet" />
    </div>
<br>
    <p id="petMessage"
    style="font-size:1.4rem; font-weight:700; text-align:center; line-height:1.35; margin:.25rem 0 1rem; color:#e9ee7e;">
    Hi, I'm your wellness buddy! <br> Let's grow together üåª
    </p>

  </div>

  <!-- (2)-->
  <div class="status-wrap card">
    <p class="pet-stats">
      <span class="pet-name">Baby ‚Ä¢ Feeds:</span>
      <span id="feedCount">0</span>
    </p>
  </div>
  
  <br>

  </section>
  <!-- END: brown hero strip -->


<div class="button-stack">
  <h3>Journal to feed your pet...</h3>

  <button id="journalBtn" class="white-button" onclick="setJournalClicked(); window.location.href='journal.html';">
    üìù Go Journal
  </button>

  <button id="feedPetBtn" class="white-button" disabled>
    üçΩÔ∏è Feed Pet
  </button>
</div>
 
  <br>
 
  <!-- ‚úÖ outside the stack, same structure as the others -->
  <p id="feedMsg" class="thankMsg">Thanks for journaling today, <br>your mind thanks you! üêæ</p>
</div>

    <div class="section" id="waterSection">
      <br>
      <h3>Did you drink water today?</h3>
      <div class="button-stack">
        <button id="waterYesBtn" class="white-button" onclick="waterPet()">‚úÖ Yes</button>
        <button id="waterNoBtn" class="white-button" onclick="alert('You deserve kindness üíñ')">‚ùå No</button>
      </div>
      <br>
      <p id="waterMsg" class="thankMsg">Thanks for drinking water today, <br> your body thanks you!</p>
<br>
</div>

    <div class="section" id="kindnessSection">
      <h3>Did you do something kind <br> for yourself today?</h3>
      <div class="button-stack">
        <button id="bathYesBtn" class="white-button" onclick="bathePet()">‚úÖ Yes</button>
        <button id="bathNoBtn" class="white-button" onclick="alert('You deserve kindness üíñ')">‚ùå No</button>
      </div>

      <br>
      <p id="bathMsg" class="thankMsg">Thanks for your kindness today!</p>
    </div>  
  
    <!-- Daily-complete message (initially hidden) -->
    <div id="completeMsg" class="come-back" role="status" aria-live="polite">
      You‚Äôre all set! <br> Come back tomorrow to care for your pet üêæ
    </div>
    
    <div class="torn-paper-divider"></div>

    <section class="pet-badges" id="petBadgeWall">
    <br>  
    <h3>üèÖ My Badges</h3><br>
      <div class="badge-grid" id="petBadgeGrid"></div>
    </section>

    <div class="torn-paper-divider"></div>
    <br>

    <button id="resetPetBtn" class="reset-btn" onclick="resetPet()">Reset Pet</button>
  
    <div class="legal-footer">View our <a href="privacy.html" rel="noopener">Privacy Policy</a>.</div>

    <!-- ADDED: minimal, visible Privacy link (no other layout changes) -->
    <!-- ========== IDENTICAL NAV HTML (copy this exact block to every page) ========== -->
    <!-- Standard Bottom Nav (use on every page) -->
    <footer class="gs-nav">
      <a href="index.html" class="gs-nav__item"><span class="ico">üè†</span><span>Home</span></a>
      <a href="toolkit-hub.html" class="gs-nav__item" data-auth="true"><span class="ico">üß∞</span><span>Toolkit</span></a>
      <a href="wellness.html" class="gs-nav__item" data-auth="true"><span class="ico">üíñ</span><span>Wellness</span></a>
      <a href="pet.html" class="gs-nav__item" data-auth="true"><span class="ico">üêæ</span><span>Pet</span></a>
      <a href="important-numbers.html" class="gs-nav__item"><span class="ico">üÜò</span><span>Help</span></a>
      <a href="systemSettings.html" class="gs-nav__item" data-auth="true"><span
          class="ico">‚ò∏</span><span>Settings</span></a>
      </footer>

  <!-- =================== PAGE SCRIPT =================== -->
  <!-- =================== PAGE SCRIPT (final) =================== -->
  <script type="module">
    import { auth } from "./firebase-init.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    /* ---------- Tiny toast UI ---------- */
    (function ensureToastUI() {
      if (!document.getElementById("toast-style")) {
        const s = document.createElement("style");
        s.id = "toast-style";
        s.textContent = `
          .toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%) translateY(16px);
            min-width:240px;max-width:92vw;padding:12px 16px;border-radius:12px;background:rgba(0,0,0,.85);
            color:#fff;font-weight:600;font-size:14px;line-height:1.35;box-shadow:0 6px 20px rgba(0,0,0,.25);
            opacity:0;pointer-events:none;transition:opacity .25s ease,transform .25s ease;z-index:9999}
          .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
          .toast .small{display:block;font-weight:500;opacity:.85;margin-top:4px}
          [data-offline="1"]{opacity:.6;filter:grayscale(.25)}
        `;
        document.head.appendChild(s);
      }
      if (!document.getElementById("appToast")) {
        const d = document.createElement("div");
        d.id = "appToast";
        d.className = "toast";
        d.role = "status";
        d.setAttribute("aria-live", "polite");
        document.body.appendChild(d);
      }
    })();

    function showToast(msg, sub = "") {
      const el = document.getElementById("appToast");
      if (!el) return;
      el.innerHTML = sub ? `${msg}<span class="small">${sub}</span>` : msg;
      el.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => el.classList.remove("show"), 2400);
    }
    window.__showToast = showToast; // optional reuse

    /* ---------- Reveal helper ---------- */
    const reveal = () => document.documentElement.setAttribute("data-ready", "1");

    /* ---------- Link/action classification ---------- */
    function isInternalPageLink(a) {
      if (!a || a.tagName !== "A") return false;
      const href = a.getAttribute("href") || "";
      try {
        const u = new URL(href, location.href);
        const sameOrigin = u.origin === location.origin;
        const isPage = /\.html(?:[#?].*)?$/i.test(u.pathname) || u.pathname === "/" || href.startsWith("#");
        const isTelMail = /^mailto:|^tel:/i.test(href);
        return sameOrigin && isPage && !isTelMail;
      } catch {
        return /\.html(?:[#?].*)?$/.test(href) || href === "" || href.startsWith("#");
      }
    }
    function isActionControl(el) {
      if (!el) return false;
      const tag = el.tagName;
      if (tag === "BUTTON") return true;
      if (tag === "INPUT") {
        const type = (el.getAttribute("type") || "").toLowerCase();
        return type === "button" || type === "submit";
      }
      return el.getAttribute?.("role") === "button";
    }

    /* ---------- Offline guard ---------- */
    function setOfflineState(isOffline) {
      document.querySelectorAll('button, input[type="button"], input[type="submit"], [role="button"]').forEach(btn => {
        const wrapperLink = btn.closest("a[href]");
        if (wrapperLink && isInternalPageLink(wrapperLink)) {
          btn.removeAttribute("data-offline");
          btn.disabled = false;
          return;
        }
        if (isOffline) {
          btn.setAttribute("data-offline", "1");
          btn.disabled = true;
        } else {
          btn.removeAttribute("data-offline");
          if (btn.disabled) btn.disabled = false;
        }
      });
    }
    function installGlobalOfflineClickTrap() {
      document.addEventListener("click", (e) => {
        if (navigator.onLine) return;
        const a = e.target.closest?.("a[href]");
        if (a && isInternalPageLink(a)) return;
        const ctl = e.target.closest?.('button, [role="button"], input[type="button"], input[type="submit"]');
        if (ctl && isActionControl(ctl)) {
          e.preventDefault();
          e.stopImmediatePropagation();
          e.stopPropagation();
          showToast("You‚Äôre offline", "Actions are disabled. You can still browse.");
        }
      }, true);
    }
    function wireGlobalOfflineGuard() {
      installGlobalOfflineClickTrap();
      setOfflineState(!navigator.onLine);
      window.addEventListener("online", () => { setOfflineState(false); showToast("Back online", "Syncing any saved journal‚Ä¶"); });
      window.addEventListener("offline", () => { setOfflineState(true); showToast("You‚Äôre offline", "Actions are disabled. You can still browse."); });
    }

    /* ---------- SW background-sync nudge ---------- */
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.addEventListener("message", (ev) => {
        if (ev.data && ev.data.type === "SYNC_OUTBOX") {
          showToast("Syncing‚Ä¶", "Checking if your pet can eat now");
        }
      });
    }

    /* ---------- Auth + boot pet.page.js ---------- */
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        const next = encodeURIComponent(location.pathname + location.search + location.hash);
        location.replace(`login.html?next=${next}`);
        return;
      }

      reveal();

      // Lazy Firestore for faster first paint
      const {
        doc, getDoc, setDoc, updateDoc, onSnapshot, deleteDoc,
        collection, serverTimestamp, increment, runTransaction,
        arrayUnion, getDocs
      } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");

      // OPTIONAL: keep the localStorage badge cache in sync with Firestore (prevents stale LS from lighting tiles elsewhere)
      try {
        const uid = user.uid;
        const rootSnap = await getDoc(doc((await import("./firebase-init.js")).db, "users", uid));
        const rootBadges = Array.isArray(rootSnap.data()?.badges) ? rootSnap.data().badges : [];
        const sub = await getDocs(collection((await import("./firebase-init.js")).db, "users", uid, "badges"));
        const subBadges = sub.docs.map(d => d.id);
        const merged = [...new Set([...rootBadges, ...subBadges])];
        try { localStorage.setItem(`badges:${uid}`, JSON.stringify({ earned: merged })); } catch { }
      } catch { /* non-fatal */ }

      // Boot the page logic (builds badge wall, handles feed/water/bath, etc.)
      const { bootPetPage } = await import("./pet.page.js");
      bootPetPage({
        firestore: {
          doc, getDoc, setDoc, updateDoc, onSnapshot, deleteDoc,
          collection, serverTimestamp, increment, runTransaction,
          arrayUnion, getDocs
        },
        auth,
        user
      });

      // After UI exists, enforce offline behavior across the whole page
      wireGlobalOfflineGuard();
    });
  </script>

<script>
  /* ========== GLOBAL NAV SCRIPT (tiny, repeat on every page) ========== */
  (function () {
    // 1) Mark current tab active
    const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('.bottom-nav .nav-icon').forEach(a => {
      const href = (a.getAttribute('href') || '').toLowerCase();
      if (href === here) a.setAttribute('aria-current', 'page');
    });

    // 2) Gate authed links (replace with your real auth check if needed)
    const isAuthed = !!localStorage.getItem('currentUser');
    document.querySelectorAll('.bottom-nav [data-auth="true"]').forEach(a => {
      if (isAuthed) return;
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const dest = a.getAttribute('href') || 'index.html';
        location.href = `login.html?next=${encodeURIComponent(dest)}`;
      });
    });
  })();
</script>

<script>
  /* ========== GLOBAL NAV SCRIPT (tiny, repeat on every page) ========== */
  (function () {
    // 1) Mark current tab active
    const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();
    document.querySelectorAll('.bottom-nav .nav-icon').forEach(a => {
      const href = (a.getAttribute('href') || '').toLowerCase();
      if (href === here) a.setAttribute('aria-current', 'page');
    });

    // 2) Gate authed links (replace with your real auth check if needed)
    const isAuthed = !!localStorage.getItem('currentUser');
    document.querySelectorAll('.bottom-nav [data-auth="true"]').forEach(a => {
      if (isAuthed) return;
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const dest = a.getAttribute('href') || 'index.html';
        location.href = `login.html?next=${encodeURIComponent(dest)}`;
      });
    });
  })();
</script>

</body>
</html>
